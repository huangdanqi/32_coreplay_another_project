# 🧠 简单日记API - 条件逻辑详细分析

## 📊 条件逻辑流程图 (中文版)

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                               条件逻辑流程                                       │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   事件输入       │    │   事件详情      │    │   条件检查      │    │   决策逻辑      │
│                 │───▶│   生成          │───▶│   引擎          │───▶│   处理器        │
│ 事件类别         │    │                 │    │                 │    │                 │
│ 事件名称         │    │ 基于类型自动    │    │ 多因素分析      │    │ 随机+规则       │
└─────────────────┘    │ 生成            │    │                 │    │ 组合            │
         │               └─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │                       │
         │                       │                       │                       │
         ▼                       ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   验证层         │    │   上下文构建    │    │   概率计算      │    │   结果生成      │
│                 │    │                 │    │                 │    │                 │
│ 检查events.json │    │ 添加时间戳      │    │ 基础: 50%       │    │ 日记或          │
│ 验证格式        │    │ 添加情感        │    │ 修正: ±20%      │    │ 原因消息        │
└─────────────────┘    │ 添加元数据      │    │ 规则: ±30%      │    └─────────────────┘
```

## 🔄 详细条件处理步骤

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            条件处理管道                                          │
└─────────────────────────────────────────────────────────────────────────────────┘

步骤1: 输入验证
┌─────────────────────────────────────────────────────────────────────────────────┐
│ function validateInput(eventCategory, eventName):                               │
│   if eventCategory not in events.json:                                        │
│     return {valid: false, error: "无效类别"}                                      │
│                                                                                 │
│   if eventName not in events.json[eventCategory]:                             │
│     return {valid: false, error: "无效事件"}                                     │
│                                                                                 │
│   return {valid: true, data: {category: eventCategory, name: eventName}}       │
└─────────────────────────────────────────────────────────────────────────────────┘

步骤2: 上下文构建
┌─────────────────────────────────────────────────────────────────────────────────┐
│ function buildContext(eventCategory, eventName):                               │
│   context = {                                                                  │
│     timestamp: getCurrentTime(),                                               │
│     event_type: eventCategory,                                                 │
│     event_name: eventName,                                                     │
│     auto_generated: true                                                       │
│   }                                                                            │
│                                                                                 │
│   // 添加特定类别的上下文                                                       │
│   switch eventCategory:                                                        │
│     case "human_toy_interactive_function":                                     │
│       context.interaction_context = buildInteractionContext(eventName)        │
│       context.emotion_base = getEmotionFromEvent(eventName)                    │
│       context.intensity = getIntensityFromEvent(eventName)                     │
│                                                                                 │
│     case "weather_events":                                                     │
│       context.weather_context = buildWeatherContext(eventName)                 │
│       context.seasonal_factor = getSeasonalFactor()                           │
│                                                                                 │
│     case "unkeep_interactive":                                                 │
│       context.neglect_context = buildNeglectContext(eventName)                 │
│       context.time_factor = getTimeFactor(eventName)                           │
│                                                                                 │
│   return context                                                               │
└─────────────────────────────────────────────────────────────────────────────────┘

步骤3: 条件评估
┌─────────────────────────────────────────────────────────────────────────────────┐
│ function evaluateCondition(context):                                           │
│   baseProbability = 0.5  // 50% 基础概率                                       │
│   modifiers = []                                                               │
│                                                                                 │
│   // 事件类型修正值                                                             │
│   if context.event_type == "human_toy_interactive_function":                   │
│     if "liked" in context.event_name:                                          │
│       modifiers.append(+0.2)  // +20% 积极互动                                 │
│     elif "disliked" in context.event_name:                                     │
│       modifiers.append(-0.1)  // -10% 消极互动                                │
│                                                                                 │
│   // 基于时间的修正值                                                           │
│   currentHour = getCurrentHour()                                               │
│   if 6 <= currentHour <= 10:  // 早晨                                           │
│     modifiers.append(+0.1)   // +10% 早晨加成                                   │
│   elif 22 <= currentHour <= 24:  // 晚上                                        │
│     modifiers.append(+0.15)  // +15% 晚上加成                                  │
│                                                                                 │
│   // 情感强度修正值                                                             │
│   if context.intensity == "high":                                              │
│     modifiers.append(+0.2)   // +20% 高强度                                     │
│   elif context.intensity == "low":                                             │
│     modifiers.append(-0.1)   // -10% 低强度                                     │
│                                                                                 │
│   // 计算最终概率                                                               │
│   finalProbability = baseProbability + sum(modifiers)                          │
│   finalProbability = max(0.0, min(1.0, finalProbability))  // 限制在[0,1]     │
│                                                                                 │
│   return {                                                                     │
│     should_generate: random.random() < finalProbability,                       │
│     probability: finalProbability,                                             │
│     modifiers: modifiers,                                                      │
│     reason: generateReason(finalProbability, modifiers)                        │
│   }                                                                            │
└─────────────────────────────────────────────────────────────────────────────────┘

步骤4: 决策处理
┌─────────────────────────────────────────────────────────────────────────────────┐
│ function processDecision(conditionResult, context):                            │
│   if conditionResult.should_generate:                                          │
│     // 生成日记条目                                                             │
│     diaryEntry = generateDiaryEntry(context)                                    │
│     return {                                                                   │
│       success: true,                                                           │
│       diary_generated: true,                                                   │
│       diary_entry: diaryEntry,                                                 │
│       probability: conditionResult.probability,                               │
│       modifiers: conditionResult.modifiers                                     │
│     }                                                                          │
│   else:                                                                        │
│     // 返回不生成的原因                                                         │
│     return {                                                                   │
│       success: true,                                                           │
│       diary_generated: false,                                                  │
│       reason: conditionResult.reason,                                          │
│       probability: conditionResult.probability,                               │
│       modifiers: conditionResult.modifiers                                     │
│     }                                                                          │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🎯 条件逻辑决策树

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              决策树逻辑                                          │
└─────────────────────────────────────────────────────────────────────────────────┘

                    ┌─────────────────┐
                    │   事件输入       │
                    │  (类别 +         │
                    │   名称)          │
                    └─────────┬───────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │  输入有效?       │
                    │  ┌─────────────┐│
                    │  │ 检查是否在   ││
                    │  │ events.json ││
                    │  │ 中存在      ││
                    │  └─────────────┘│
                    └─────────┬───────┘
                              │
                    ┌─────────┴───────┐
                    │                │
                    ▼                ▼
            ┌─────────────┐  ┌─────────────┐
            │    是       │  │    否       │
            │             │  │             │
            ▼             │  │             │
    ┌─────────────┐      │  │             │
    │ 构建上下文  │      │  │             │
    │            │      │  │             │
    └─────┬───────┘      │  │             │
          │              │  │             │
          ▼              │  │             │
    ┌─────────────┐      │  │             │
    │ 计算概率    │      │  │             │
    │            │      │  │             │
    └─────┬───────┘      │  │             │
          │              │  │             │
          ▼              │  │             │
    ┌─────────────┐      │  │             │
    │ 应用修正值  │      │  │             │
    │            │      │  │             │
    └─────┬───────┘      │  │             │
          │              │  │             │
          ▼              │  │             │
    ┌─────────────┐      │  │             │
    │ 随机决策    │      │  │             │
    │            │      │  │             │
    └─────┬───────┘      │  │             │
          │              │  │             │
          ▼              │  │             │
    ┌─────────────┐      │  │             │
    │ 生成日记?    │      │  │             │
    │            │      │  │             │
    └─────┬───────┘      │  │             │
          │              │  │             │
    ┌─────┴───────┐      │  │             │
    │            │      │  │             │
    ▼            ▼      │  │             │
┌─────────┐ ┌─────────┐│  │             │
│   是    │ │   否    ││  │             │
│         │ │         ││  │             │
│ 调用    │ │ 返回    ││  │             │
│ LLM     │ │ 原因    ││  │             │
│ 生成    │ │ 消息    ││  │             │
│ 日记    │ │         ││  │             │
└─────────┘ └─────────┘│  │             │
                      │  │             │
                      │  │             │
                      ▼  ▼             ▼
                  ┌─────────────┐ ┌─────────────┐
                  │   成功      │ │   错误      │
                  │   响应      │ │   响应      │
                  │             │ │             │
                  │ 包含日记或   │ │ 包含错误    │
                  │ 原因的JSON  │ │ 消息的JSON  │
                  └─────────────┘ └─────────────┘
```

## 🔧 修正值系统详情

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              修正值系统                                          │
└─────────────────────────────────────────────────────────────────────────────────┘

基础概率: 50% (0.5)

事件类型修正值:
┌─────────────────────┬─────────────────────┬─────────────────────┬─────────────────────┐
│    事件类别          │    事件模式          │    修正值           │    原因              │
├─────────────────────┼─────────────────────┼─────────────────────┼─────────────────────┤
│ human_toy_interactive│ liked_interaction   │ +20% (+0.2)        │ 积极情感             │
│ human_toy_interactive│ disliked_interaction│ -10% (-0.1)        │ 消极情感             │
│ human_toy_interactive│ neutral_interaction │ +5% (+0.05)        │ 中性状态             │
│ human_toy_talk      │ positive_dialogue   │ +15% (+0.15)       │ 积极对话             │
│ human_toy_talk      │ negative_dialogue   │ -5% (-0.05)        │ 消极对话             │
│ unkeep_interactive  │ neglect_1_day       │ +10% (+0.1)        │ 短期忽视             │
│ unkeep_interactive  │ neglect_7_days       │ -15% (-0.15)       │ 中期忽视             │
│ unkeep_interactive  │ neglect_30_days      │ -25% (-0.25)       │ 长期忽视             │
│ weather_events      │ favorite_weather     │ +25% (+0.25)       │ 喜欢的天气           │
│ weather_events      │ dislike_weather      │ -20% (-0.2)        │ 不喜欢的天气         │
│ holiday_events      │ approaching_holiday  │ +30% (+0.3)        │ 期待感               │
│ holiday_events      │ during_holiday       │ +35% (+0.35)       │ 活跃庆祝             │
│ holiday_events      │ holiday_ends          │ -10% (-0.1)        │ 假期后忧郁           │
│ friends_function    │ made_new_friend      │ +40% (+0.4)        │ 社交兴奋             │
│ friends_function    │ friend_deleted       │ -30% (-0.3)        │ 社交损失             │
│ friends_function    │ liked_5_plus          │ +20% (+0.2)        │ 社交认可             │
│ adopted_function    │ toy_claimed           │ +50% (+0.5)        │ 重大生活事件         │
└─────────────────────┴─────────────────────┴─────────────────────┴─────────────────────┘

基于时间的修正值:
┌─────────────────────┬─────────────────────┬─────────────────────┬─────────────────────┐
│    时间段            │    小时范围         │    修正值           │    原因              │
├─────────────────────┼─────────────────────┼─────────────────────┼─────────────────────┤
│ 早晨                │ 06:00 - 10:00      │ +10% (+0.1)        │ 全新开始             │
│ 上午                │ 10:00 - 12:00      │ +5% (+0.05)        │ 活跃时段             │
│ 下午                │ 12:00 - 18:00      │ +0% (0.0)          │ 中性时段             │
│ 傍晚                │ 18:00 - 22:00      │ +15% (+0.15)       │ 反思时间             │
│ 深夜                │ 22:00 - 24:00      │ +20% (+0.2)        │ 深度反思             │
│ 夜间                │ 00:00 - 06:00      │ -10% (-0.1)        │ 睡眠时间             │
└─────────────────────┴─────────────────────┴─────────────────────┴─────────────────────┘

强度修正值:
┌─────────────────────┬─────────────────────┬─────────────────────┬─────────────────────┐
│    强度等级          │    描述              │    修正值           │    原因              │
├─────────────────────┼─────────────────────┼─────────────────────┼─────────────────────┤
│ 高                  │ 强烈情感            │ +20% (+0.2)        │ 难忘事件             │
│ 中                  │ 中等情感            │ +0% (0.0)          │ 标准事件             │
│ 低                  │ 轻微情感            │ -10% (-0.1)        │ 不太难忘             │
│ 极高                │ 强烈情感            │ +30% (+0.3)        │ 高度难忘             │
└─────────────────────┴─────────────────────┴─────────────────────┴─────────────────────┘

频率修正值:
┌─────────────────────┬─────────────────────┬─────────────────────┬─────────────────────┐
│    频率              │    模式              │    修正值           │    原因              │
├─────────────────────┼─────────────────────┼─────────────────────┼─────────────────────┤
│ 首次                │ 初次发生            │ +25% (+0.25)       │ 新奇因素             │
│ 偶尔                │ 2-5次               │ +10% (+0.1)        │ 规律模式             │
│ 频繁                │ 5次以上             │ -5% (-0.05)        │ 例行行为             │
│ 罕见                │ <1% 发生            │ +40% (+0.4)        │ 独特性因素           │
└─────────────────────┴─────────────────────┴─────────────────────┴─────────────────────┘
```

## 🎲 概率计算示例

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           概率计算示例                                            │
└─────────────────────────────────────────────────────────────────────────────────┘

示例1: 傍晚的积极互动
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 事件: human_toy_interactive_function + liked_interaction_once                   │
│ 时间: 20:30 (傍晚)                                                              │
│                                                                                 │
│ 基础概率: 50% (0.5)                                                            │
│ 事件修正值: +20% (喜欢的互动)                                                   │
│ 时间修正值: +15% (傍晚)                                                         │
│ 强度修正值: +10% (中高强度)                                                     │
│                                                                                 │
│ 最终概率 = 0.5 + 0.2 + 0.15 + 0.1 = 0.95 (95%)                                │
│ 结果: 非常可能生成日记                                                           │
└─────────────────────────────────────────────────────────────────────────────────┘

示例2: 夜间的不喜欢天气
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 事件: weather_events + dislike_weather                                          │
│ 时间: 02:15 (夜间)                                                              │
│                                                                                 │
│ 基础概率: 50% (0.5)                                                            │
│ 事件修正值: -20% (不喜欢的天气)                                                 │
│ 时间修正值: -10% (夜间)                                                         │
│ 强度修正值: -5% (低强度)                                                        │
│                                                                                 │
│ 最终概率 = 0.5 - 0.2 - 0.1 - 0.05 = 0.15 (15%)                                │
│ 结果: 不太可能生成日记                                                           │
└─────────────────────────────────────────────────────────────────────────────────┘

示例3: 早晨的假期庆祝
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 事件: holiday_events + during_holiday                                           │
│ 时间: 09:30 (早晨)                                                              │
│                                                                                 │
│ 基础概率: 50% (0.5)                                                            │
│ 事件修正值: +35% (假期期间)                                                     │
│ 时间修正值: +10% (早晨)                                                         │
│ 强度修正值: +20% (高强度)                                                       │
│                                                                                 │
│ 最终概率 = 0.5 + 0.35 + 0.1 + 0.2 = 1.15 → 1.0 (100%)                         │
│ 结果: 保证生成日记                                                               │
└─────────────────────────────────────────────────────────────────────────────────┘

示例4: 下午的长期忽视
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 事件: unkeep_interactive + neglect_30_days_no_interaction                      │
│ 时间: 15:45 (下午)                                                              │
│                                                                                 │
│ 基础概率: 50% (0.5)                                                            │
│ 事件修正值: -25% (长期忽视)                                                     │
│ 时间修正值: +0% (下午)                                                          │
│ 强度修正值: -15% (消极强度)                                                     │
│                                                                                 │
│ 最终概率 = 0.5 - 0.25 - 0.0 - 0.15 = 0.1 (10%)                                │
│ 结果: 非常不可能生成日记                                                         │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🔄 条件逻辑状态机

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              状态机逻辑                                          │
└─────────────────────────────────────────────────────────────────────────────────┘

状态和转换:
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   初始状态      │───▶│   验证中        │───▶│   处理中        │───▶│   决策中        │
│                 │    │                 │    │                 │    │                 │
│ 等待输入        │    │ 检查输入        │    │ 构建上下文      │    │ 计算概率        │
│                 │    │ 有效性          │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │                       │
         │                       │                       │                       │
         ▼                       ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   错误状态      │    │   上下文构建    │    │   修正值应用    │    │   结果状态      │
│                 │    │                 │    │                 │    │                 │
│ 无效输入        │    │ 添加元数据      │    │ 调整概率        │    │ 生成最终决策    │
│ 或格式          │    │ 和时间戳        │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │                       │
         │                       │                       │                       │
         ▼                       ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   响应状态      │    │   增强上下文    │    │   最终概率      │    │   输出状态      │
│                 │    │                 │    │                 │    │                 │
│ 错误消息        │    │ 准备处理        │    │ 准备决策        │    │ 日记或          │
│ 发送给客户端    │    │                 │    │                 │    │ 原因消息        │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 🎯 条件逻辑核心算法

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           核心算法实现                                          │
└─────────────────────────────────────────────────────────────────────────────────┘

算法1: 智能概率计算
┌─────────────────────────────────────────────────────────────────────────────────┐
│ function calculateSmartProbability(eventCategory, eventName, context):         │
│   baseProb = 0.5  // 50% 基础概率                                               │
│   modifiers = []                                                               │
│                                                                                 │
│   // 情感分析修正值                                                             │
│   emotionScore = analyzeEmotion(eventName)                                      │
│   if emotionScore > 0.7:  // 积极情感                                           │
│     modifiers.append(+0.2)                                                     │
│   elif emotionScore < 0.3:  // 消极情感                                         │
│     modifiers.append(-0.15)                                                    │
│                                                                                 │
│   // 时间模式修正值                                                             │
│   timePattern = getTimePattern(context.timestamp)                              │
│   if timePattern == "reflection_time":  // 反思时间                             │
│     modifiers.append(+0.15)                                                     │
│   elif timePattern == "sleep_time":  // 睡眠时间                                │
│     modifiers.append(-0.1)                                                     │
│                                                                                 │
│   // 事件重要性修正值                                                           │
│   importance = getEventImportance(eventCategory, eventName)                     │
│   if importance == "high":                                                      │
│     modifiers.append(+0.25)                                                     │
│   elif importance == "low":                                                     │
│     modifiers.append(-0.1)                                                      │
│                                                                                 │
│   // 用户历史模式修正值                                                         │
│   userPattern = getUserPattern(context.user_id)                                 │
│   if userPattern.frequency > 0.8:  // 高频用户                                 │
│     modifiers.append(+0.1)                                                      │
│                                                                                 │
│   finalProb = baseProb + sum(modifiers)                                        │
│   return clamp(finalProb, 0.0, 1.0)  // 限制在[0,1]范围                        │
└─────────────────────────────────────────────────────────────────────────────────┘

算法2: 上下文感知决策
┌─────────────────────────────────────────────────────────────────────────────────┐
│ function contextAwareDecision(context, probability):                           │
│   // 基础随机决策                                                               │
│   randomValue = random.random()                                                │
│   baseDecision = randomValue < probability                                      │
│                                                                                 │
│   // 上下文修正                                                                 │
│   if context.has_recent_diary:  // 最近有日记                                   │
│     if context.time_since_last < 3600:  // 1小时内                              │
│       baseDecision = false  // 避免过于频繁                                     │
│                                                                                 │
│   if context.is_special_day:  // 特殊日子                                       │
│     baseDecision = true  // 强制生成                                            │
│                                                                                 │
│   if context.user_mood == "sad":  // 用户情绪低落                               │
│     if probability > 0.3:  // 概率较高时                                        │
│       baseDecision = true  // 鼓励生成日记                                      │
│                                                                                 │
│   return {                                                                     │
│     decision: baseDecision,                                                     │
│     probability: probability,                                                  │
│     context_factors: getContextFactors(context),                               │
│     reason: generateDecisionReason(baseDecision, context)                       │
│   }                                                                            │
└─────────────────────────────────────────────────────────────────────────────────┘

算法3: 动态阈值调整
┌─────────────────────────────────────────────────────────────────────────────────┐
│ function adjustDynamicThreshold(baseThreshold, context):                       │
│   adjustedThreshold = baseThreshold                                             │
│                                                                                 │
│   // 基于历史数据调整                                                           │
│   recentDiaries = getRecentDiaries(context.user_id, hours=24)                   │
│   if len(recentDiaries) > 5:  // 最近日记较多                                  │
│     adjustedThreshold += 0.1  // 提高阈值                                      │
│   elif len(recentDiaries) < 1:  // 最近日记较少                                │
│     adjustedThreshold -= 0.1  // 降低阈值                                      │
│                                                                                 │
│   // 基于用户活跃度调整                                                         │
│   userActivity = getUserActivity(context.user_id)                               │
│   if userActivity.level == "high":                                             │
│     adjustedThreshold -= 0.05  // 活跃用户降低阈值                              │
│   elif userActivity.level == "low":                                             │
│     adjustedThreshold += 0.05  // 不活跃用户提高阈值                            │
│                                                                                 │
│   // 基于时间模式调整                                                           │
│   timePattern = getTimePattern(context.timestamp)                               │
│   if timePattern == "peak_hours":  // 高峰时段                                  │
│     adjustedThreshold -= 0.1  // 高峰时段降低阈值                              │
│                                                                                 │
│   return clamp(adjustedThreshold, 0.1, 0.9)  // 限制在合理范围                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🔍 条件逻辑测试用例

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           测试用例集合                                          │
└─────────────────────────────────────────────────────────────────────────────────┘

测试用例1: 边界条件测试
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 测试场景: 概率边界值测试                                                        │
│                                                                                 │
│ 输入:                                                                           │
│   - eventCategory: "adopted_function"                                           │
│   - eventName: "toy_claimed"                                                    │
│   - time: "09:00" (早晨)                                                        │
│                                                                                 │
│ 预期计算:                                                                       │
│   - 基础概率: 50%                                                               │
│   - 事件修正值: +50% (重大生活事件)                                             │
│   - 时间修正值: +10% (早晨)                                                     │
│   - 强度修正值: +30% (极高强度)                                                 │
│   - 最终概率: 140% → 100% (限制上限)                                            │
│                                                                                 │
│ 预期结果: 100% 概率生成日记                                                     │
└─────────────────────────────────────────────────────────────────────────────────┘

测试用例2: 负概率测试
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 测试场景: 负概率边界测试                                                        │
│                                                                                 │
│ 输入:                                                                           │
│   - eventCategory: "unkeep_interactive"                                         │
│   - eventName: "neglect_30_days_no_interaction"                                │
│   - time: "02:00" (夜间)                                                        │
│                                                                                 │
│ 预期计算:                                                                       │
│   - 基础概率: 50%                                                               │
│   - 事件修正值: -25% (长期忽视)                                                 │
│   - 时间修正值: -10% (夜间)                                                     │
│   - 强度修正值: -20% (消极强度)                                                 │
│   - 最终概率: -5% → 0% (限制下限)                                               │
│                                                                                 │
│ 预期结果: 0% 概率生成日记                                                       │
└─────────────────────────────────────────────────────────────────────────────────┘

测试用例3: 随机性测试
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 测试场景: 随机决策一致性测试                                                    │
│                                                                                 │
│ 输入:                                                                           │
│   - eventCategory: "weather_events"                                             │
│   - eventName: "favorite_weather"                                               │
│   - time: "15:00" (下午)                                                        │
│                                                                                 │
│ 预期计算:                                                                       │
│   - 基础概率: 50%                                                               │
│   - 事件修正值: +25% (喜欢的天气)                                               │
│   - 时间修正值: +0% (下午)                                                      │
│   - 强度修正值: +15% (中等强度)                                                 │
│   - 最终概率: 90%                                                               │
│                                                                                 │
│ 测试方法: 运行1000次，统计生成日记的比例                                        │
│ 预期结果: 生成比例应在85%-95%之间 (90% ± 5%)                                    │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 🎯 总结

条件逻辑系统采用复杂的多因素方法:

1. **基础概率**: 50% 起始点
2. **事件修正值**: 基于事件类型和情感内容
3. **时间修正值**: 基于一天中的时间和人类行为模式
4. **强度修正值**: 基于事件的情感强度
5. **频率修正值**: 基于事件的新奇性和稀有性

最终概率通过将所有修正值相加并限制在0%到100%之间来计算，然后基于这个概率进行随机决策。
